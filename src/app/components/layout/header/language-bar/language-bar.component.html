<div class="relative inline-block w-[76px]">
  @let selected = selectedLanguage$ | async;
  <button
    type="button"
    class="flex items-center w-full px-2 py-1 rounded border border-blue-200 bg-white text-blue-800 text-sm hover:bg-blue-100 transition focus:outline-none focus:ring-1 focus:ring-blue-400"
    (click)="toggleDropdown()"
    [attr.aria-expanded]="dropdownOpen"
    aria-haspopup="listbox"
    style="min-width: 76px"
  >
    <span class="mr-1 text-lg">{{ getLangMeta(selected)?.flag }}</span>
    <span class="uppercase tracking-wide">{{ selected }}</span>
    <span class="ml-1 flex items-center">
      <svg
        class="h-4 w-4 text-blue-300"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        viewBox="0 0 24 24"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
      </svg>
    </span>
  </button>
  @if (dropdownOpen) {
    <ul
      class="absolute left-0 z-20 mt-1 w-full min-w-[76px] bg-white border border-blue-200 rounded max-h-48 overflow-auto animate-fade-in shadow-lg"
      role="listbox"
      (mouseleave)="closeDropdown()"
    >
      @for (lang of languages; track lang.code) {
        <li
          (click)="selectLanguage(lang.code)"
          class="flex items-center px-2 py-1 cursor-pointer rounded transition-colors duration-100"
          [ngClass]="{
            'bg-blue-600 text-white': lang.code === selected,
            'hover:bg-blue-50 text-blue-800': lang.code !== selected,
          }"
          role="option"
          [attr.aria-selected]="lang.code === selected"
          style="min-width: 76px"
        >
          <span class="mr-1 text-lg">{{ lang.flag }}</span>
          <span class="uppercase tracking-wide">{{ lang.code }}</span>
        </li>
      }
    </ul>
  }
</div>
